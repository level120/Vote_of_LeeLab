{% extends "VoteApp/layout.html" %}
{% block content %}
<section id="vote" class="container content">
    <div style="margin-bottom: 20px;"></div>
    <div class="col-md-3"></div>
    <div class="col-md-6">
        <div class="call-action call-action-boxed call-action-style1 clearfix">
            <h2 style="text-align:center;" class="primary">{{ date_of_begin_time }}</h2>
        </div>
        
        <div class="alert alert-success" role="alert">
            <h4 style="text-align:center;" class="alert-heading">남은 시간 : <span style="margin-left:15px" id="day">--</span>일<span style="margin-left:15px" id="hour">--</span>시<span style="margin-left:15px" id="min">--</span>분<span style="margin-left:15px" id="sec">--</span>초</h4>
        </div>
    </div>
    <div class="col-md-3"></div>
    <div class="row">
        <div class="col-md-12">
            <div style="margin-bottom: 20px;"></div>

            <ul class="nav nav-pills">
                <li class="active"><a href="{% url 'vote' %}">투표하기</a></li>
                <li><a href="{% url 'about' %}" style="color:black">결과보기</a></li>
            </ul>
        </div>
        <div style="margin-bottom: 20px;"></div>
        <div class="col-md-12">
            <div class="table-responsive">
                <table style="font-size: 13px" class="table table-striped table-bordered sortable-table clickable-table" id="problemset">
                    <thead>
                        <tr>
                            <th style="text-align:center;width:6%" data-sort="int">No.</th>
                            <th style="text-align:center;width:12%" data-sort="string">이름</th>
                            <th style="text-align:center;width:40%" data-sort="string">설명</th>
                            <th style="text-align:center;width:35%">득표현황</th>
                            <th style="text-align:center;width:8%">투표여부</th>
                        </tr>
                    </thead>
                    <tbody>
                        {# for player in players #}
                        <tr>
                            <td style="vertical-align:middle; text-align:center">1</td>
                            <td style="vertical-align:middle; text-align:center"><span class = 'user-green'>후보1</span></td>
                            <td style="vertical-align:middle" class="click-this">후보1의 자기소개 입니다.</td>
                            <td style="vertical-align:middle;width:35%">
                                <div class="progress progress-striped active" style="margin-bottom: 0px;">
                                    <div class="progress-bar " style="width: 68.75%;"><span style="vertical-align:middle">100</span></div>
                                    {#<div class="progress-bar progress-bar-success" style="width: 100%;">1</div>#}
                                </div>
                            </td>
                            <td style="vertical-align:middle"><button type="button" class="like btn btn-success glyphicon glyphicon-thumbs-up"> 투표하기</button></td>
                        </tr>
                        {# endfor #}
                    </tbody>

                </table>
            </div>
        </div>
    </div>

    <div style="margin-bottom: 20px;"></div>

</section>

<script type="text/javascript">
    $(document).ready(function () {
        var dday = {{ server_time }};
        if (dday > 0) {
            var timer = setInterval(function () {
                if (dday == 0) {
                    notify();
                    location.reload();
                } else {
                    var rest = --dday;
                    var sec = rest % 60;
                    var min = ((rest - sec) / 60) % 60;
                    var hours = ((((rest - sec) / 60) - min) / 60) % 24;
                    var days = ((((((rest - sec) / 60) - min) / 60) - hours) / 24);

                    $("#sec").html((sec < 10) ? ('0' + sec) : sec);
                    $("#min").html((min < 10) ? ('0' + min) : min);
                    $("#hour").html((hours < 10) ? ('0' + hours) : hours);
                    $("#day").html((days < 10) ? ('0' + days) : days);
                }
            }, 1000);
        }
        else {
            clearInterval(timer);
        }
    });

    function spawnNotification(title, body, icon) {
        var n = new Notification(title, {
            body: body,
            icon: icon
        });

        n.onclick = function (e) {
            e.preventDefault();
            window.open('{{ url }}', '_blank');
        }
    }
    
    function notify() {
        Notification.requestPermission().then(function (permission) {
            if (permission === 'granted') {
                spawnNotification('{{ noti_title }}', '{{ noti_context }}', '{{ noti_img }}');
            }
        });
    }
    
    window.addEventListener('load', function () {
        Notification.requestPermission(function (status) {
            if (Notification.permission !== status) {
                Notification.permission = status;
            }
        });
    });

</script >
{% endblock %}